{% extends 'base.html' %}
{% block subtitle %} {{request.session['scalar_or_3d'].title()}} Query Wizard {% endblock %}
{% block content %}
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="{{ static('primo/js/tablesorter-master/jquery.tablesorter.min.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ static('primo/blue/style.css') }}" />


    {% if are_results %}
    <p>Click on column headers to sort results by column. Columns can be deleted or reordered in your spreadsheet after download.</p>

    {% if is_preview == 'False' %}
        <p>If these data are what you desired, click on <a href="exportCsvFile">Download CSV file</a> to get the entire result. Also, please note that some browsers may change the extension of the resultant file. If this is the case, please rename it to .csv. Or if you do not have a user ID, please return to the <a href="{{ url('index') }}">front page</a> for instructions on how to get one.</p>

        <p><a href="exportCsvFile">Download CSV file</a></p>
    {% endif %}

    <script type="text/javascript" >
    $(document).ready(function()
        {
            $("#resultsTable").tablesorter();
        }
    );
    </script>

    {# {query_results} #}
    {# {final_sql} #}

    <br />
    <p><strong>{{total}} specimens found.</strong></p>
    <table id="resultsTable" class="tablesorter">
    <thead>
    <tr>
        {% for metadata in specimen_metadata %}
            <th>{{metadata[1]}}</th>
        {% endfor %}
        {% for var_id in variable_labels %}
            <th>{{var_id[0]}}</th>
        {% endfor %}
    </tr>
    </thead>
    <tbody>
    {% for row in query_results %}
    <tr>
        {% for metadata in specimen_metadata %}
            <td>{{row[metadata[0]]}}</td>
        {% endfor %}

        {# {% for variable in variable_labels: %}
            <td>{{variable}}</td>
        {% endfor %} #}
        {% for label in variable_labels %}
            {% if row[label[0]] %}           <!-- The last element in the tuple
                                                  is the dictionary {variable id : variable label} -->
                <td>{{ row[label[0]] }}</td> <!-- so print value at that location -->
            {% else %}
                <td></td>
            {% endif %}
        {% endfor %}
    </tr>
    {% endfor %}

    </tbody>
    </table>

    {% if is_preview == 'False' %}
        <p>If these data are what you desired, click on <a href="{{ url('exportCsvFile') }}">Download CSV file</a> to get the entire result. Also, please note that some browsers may change the extension of the resultant file. If this is the case, please rename it to .csv. Or if you do not have a user ID, please return to the <a href="{{ url('index') }}">front page</a> for instructions on how to get one.</p>

        <p><a href="exportCsvFile">Download CSV file</a></p>
    {% endif %}
{% else %}
    <h3>No results were returned.</h3>
{% endif %}

<!-- {% for row in request.session['results'] %}
<tr>
    {% for column in row %}
    <td>Smith</td>
    <td>John</td>
    <td>jsmith@gmail.com</td>
    <td>$50.00</td>
    <td>http://www.jsmith.com</td>
    {% endfor %}
</tr>
{% endfor %}

{{ request.session['query'] }}
 <tr>
    <td>Smith</td>
    <td>John</td>
    <td>jsmith@gmail.com</td>
    <td>$50.00</td>
    <td>http://www.jsmith.com</td>
</tr>
<tr>
    <td>Bach</td>
    <td>Frank</td>
    <td>fbach@yahoo.com</td>
    <td>$50.00</td>
    <td>http://www.frank.com</td>
</tr>
<tr>
    <td>Doe</td>
    <td>Jason</td>
    <td>jdoe@hotmail.com</td>
    <td>$100.00</td>
    <td>http://www.jdoe.com</td>
</tr>
<tr>
    <td>Conway</td>
    <td>Tim</td>
    <td>tconway@earthlink.net</td>
    <td>$50.00</td>
    <td>http://www.timconway.com</td>
</tr>
</tbody>
</table>
{{ request.session['final_result'] }}
<div id="query-wizard-filter-tables">
    <table width="30%" border="0" cellspacing="0" id="resultsTable" class="tablesorter">
        <tr><th>Table</th><th>Attributes Selected</th></tr>
{% for table in tables %}

        <tr>
            <td><a href="{{ url('parameter_selection', table['table_name']) }}">{{ table['display_name']|safe() }} &raquo;</a></td>
            {% if selected[table['table_name']] %}
            <td><img alt="selected" align="middle" src="{{ static('primo/images/tick.gif') }}" /></td>
            {% else %}
            <td><img alt="selected" align="middle" src="{{ static('primo/images/tick2_blank.gif') }}" /></td>
            {% endif %}
    {% endfor %}
    </table>
</div>
    <br />

    <a href="{{ url('query_start') }}">Reset Query </a>

    {% if finished %}
        &nbsp;&nbsp; :: &nbsp;&nbsp;
        <a href="{{ url('query'), isScalar, '', True }}">Preview format  &raquo;</a>
        &nbsp;&nbsp; :: &nbsp;&nbsp;
        {% if scalar_or_3d == "scalar" %}
            <a href="{{ url('query'), isScalar, '', False }}">See results  &raquo;</a>
        {% else %}
            <a href="{{ url('query'), isScalar, 'Morphologika', False }}">Download Morphologika file  &raquo;</a>
            &nbsp;&nbsp; :: &nbsp;&nbsp;
            <a href="{{ url('query'), isScalar, 'GRFND', False }}">Download GRFND file  &raquo;</a>
        {% endif %}

    {% endif %}
    <br />
</div>

--> {% endblock %}
